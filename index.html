<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Essex Postcode Districts – The Learning Hive</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<style>
html,body{margin:0;height:100%;width:100%}
#app{display:grid;grid-template-columns:1fr 400px;height:100vh;width:100vw}
#map{height:100%;width:100%}
#sidebar{border-left:1px solid #e5e7eb;background:#fff;font:14px/1.4 "Nunito",sans-serif;display:flex;flex-direction:column}
.side-header{padding:10px 14px;border-bottom:1px solid #e5e7eb;font-weight:700}
.search{padding:8px 14px}
.search input{width:100%;padding:8px;border:1px solid #d1d5db;border-radius:8px;font:inherit}
.list{overflow:auto;flex:1;padding:4px 8px}
.item{padding:8px 10px;border-radius:8px;cursor:pointer}
.item:hover{background:#f3f4f6}
.item.active{border:1px solid #9ca3af;background:#f9fafb}
.pc{font-weight:800}
.mtown{font-weight:600}
.locals{font-size:12px;color:#6b7280}
#brand{position:fixed;left:10px;bottom:55px;display:flex;align-items:center;gap:8px;z-index:1001}
#brand img{width:70px;opacity:.4}
#brand .credit{font:12px/1.2 "Nunito",sans-serif;color:#6b7280}
.pc-label{font-family:"Baloo 2",sans-serif;font-weight:600;font-size:16px;
 text-shadow:0 0 3px #fff,0 0 8px #fff;opacity:0;transition:opacity .3s}
body.labels-visible .pc-label{opacity:1}
#resetBtn{position:fixed;bottom:20px;right:20px;background:#fff;border:1px solid #d1d5db;
border-radius:8px;padding:6px 10px;font:13px "Nunito",sans-serif;cursor:pointer;
box-shadow:0 1px 4px rgba(0,0,0,.1);display:none}
#resetBtn:hover{background:#f3f4f6}
</style>
</head>
<body>
<div id="app">
  <div id="map"></div>
  <aside id="sidebar">
    <div class="side-header">Essex Postcode Districts</div>
    <div class="search"><input id="search" placeholder="Filter by postcode or place…"></div>
    <div id="list" class="list"></div>
  </aside>
</div>
<div id="brand">
  <img src="https://raw.githubusercontent.com/github/explore/main/topics/leaflet/leaflet.png" alt="">
  <div class="credit">© The Learning Hive 2025</div>
</div>
<button id="resetBtn">Reset View</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map=L.map('map').setView([51.77,0.54],9);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'© OpenStreetMap'}).addTo(map);

const areas={CM:'#1f77b4',CO:'#ff7f0e',SS:'#2ca02c',IG:'#d62728',RM:'#9467bd'};
const urls={
 CM:'https://raw.githubusercontent.com/missinglink/uk-postcode-polygons/master/geojson/CM.geojson',
 CO:'https://raw.githubusercontent.com/missinglink/uk-postcode-polygons/master/geojson/CO.geojson',
 SS:'https://raw.githubusercontent.com/missinglink/uk-postcode-polygons/master/geojson/SS.geojson',
 IG:'https://raw.githubusercontent.com/missinglink/uk-postcode-polygons/master/geojson/IG.geojson',
 RM:'https://raw.githubusercontent.com/missinglink/uk-postcode-polygons/master/geojson/RM.geojson'
};
const districtInfo={{
 "CM16":{main:"Epping",locals:["Theydon Bois","North Weald","Waltham Abbey"]},
 "CM17":{main:"Harlow (Church Langley)",locals:["Old Harlow","Newhall"]},
 "CM18":{main:"Harlow (South)",locals:["Sumners","Katherines"]},
 "CM19":{main:"Harlow (West)",locals:["Staple Tye","Kingsmoor"]},
 "CM20":{main:"Harlow (Central)",locals:["Town Centre"]},
 "CM1":{main:"Chelmsford",locals:["Writtle","Broomfield"]},
 "CM2":{main:"Chelmsford",locals:["Great Baddow","Galleywood"]},
 "CM3":{main:"Danbury",locals:["South Woodham Ferrers","Hatfield Peverel"]},
 "SS6":{main:"Rayleigh",locals:["Rawreth"]},
 "SS7":{main:"Benfleet",locals:["Hadleigh","Thundersley"]},
 "SS9":{main:"Leigh-on-Sea",locals:["Eastwood"]},
 "CO1":{main:"Colchester (Central)",locals:[]},
 "CO2":{main:"Colchester (South)",locals:["Rowhedge","Abberton"]},
 "CO3":{main:"Colchester (West)",locals:["Lexden"]},
 "CO4":{main:"Colchester (North)",locals:["Highwoods","Mile End"]},
 "CO5":{main:"Tiptree",locals:["Tolleshunt","Layer","Marks Tey"]},
 "CO7":{main:"Wivenhoe",locals:["Alresford","Brightlingsea"]},
 "IG10":{main:"Loughton",locals:["Debden"]},
 "IG9":{main:"Buckhurst Hill",locals:[]},
 "IG7":{main:"Chigwell",locals:["Chigwell Row"]},
 "RM16":{main:"Grays",locals:["Chafford Hundred","Orsett"]},
 "RM17":{main:"Grays (Town)",locals:[]},
 "RM18":{main:"Tilbury",locals:["East Tilbury"]},
 "RM19":{main:"Purfleet-on-Thames",locals:[]},
 "RM20":{main:"West Thurrock",locals:["Lakeside"]}
};

const resetBtn=document.getElementById('resetBtn');
const essexBounds=L.latLngBounds([[51.42,-0.10],[52.19,1.25]]);
const districts=L.layerGroup().addTo(map);
const labels=L.layerGroup().addTo(map);
const codeLayer=new Map(),codeBounds=new Map();

Promise.all(Object.entries(urls).map(([k,u])=>fetch(u).then(r=>r.json()).then(j=>({k,j})))).then(data=>{
 data.forEach(({k,j})=>{
  L.geoJSON(j,{
   style:()=>({color:areas[k],weight:1.5,fillOpacity:.1}),
   onEachFeature:(f,l)=>{
    const code=f.properties.name||f.properties.postcode;
    if(!code||!districtInfo[code])return;
    codeLayer.set(code,l);codeBounds.set(code,l.getBounds());
    const c=l.getBounds().getCenter();
    const icon=L.divIcon({className:'pc-label',html:`<span style="color:${areas[k]}">${code}</span>`});
    const m=L.marker(c,{icon});
    const d=districtInfo[code];
    const desc=[d.main,...d.locals].join(', ');
    m.bindTooltip(`${code} — ${desc}`,{direction:'top',offset:[0,-8]});
    m.addTo(labels);
    l.on('mouseover',()=>highlight(code));
    l.on('mouseout',()=>!locked&&clearHighlight());
    l.on('click',()=>toggleLock(code));
   }
  }).addTo(districts);
 });
 buildSidebar();
 map.fitBounds(essexBounds.pad(0.05));
 map.on('zoomend',()=>document.body.classList.toggle('labels-visible',map.getZoom()>=10));
});

let locked=null;
function highlight(code){
 clearHighlight();
 const l=codeLayer.get(code);if(!l)return;
 const a=code.slice(0,2);l.setStyle({color:areas[a],weight:3,fillOpacity:.25});
 const item=document.querySelector(`.item[data-code="${code}"]`);if(item)item.classList.add('active');
}
function clearHighlight(){
 codeLayer.forEach((l,c)=>{const a=c.slice(0,2);l.setStyle({color:areas[a],weight:1.5,fillOpacity:.1});});
 document.querySelectorAll('.item').forEach(i=>i.classList.remove('active'));
}
function toggleLock(code){
 if(locked===code){locked=null;resetView();}
 else{locked=code;highlight(code);if(codeBounds.has(code))map.flyToBounds(codeBounds.get(code).pad(0.05));resetBtn.style.display='block';}
}
function resetView(){if(locked)return;clearHighlight();map.flyToBounds(essexBounds.pad(0.05));resetBtn.style.display='none';}
resetBtn.onclick=()=>{locked=null;resetView();};

function buildSidebar(){
 const list=document.getElementById('list');
 list.innerHTML=Object.keys(districtInfo).sort().map(c=>{
  const d=districtInfo[c];return `<div class="item" data-code="${c}">
  <div class="pc">${c}</div><div class="mtown">${d.main}</div>
  <div class="locals">${(d.locals||[]).join(', ')}</div></div>`;}).join('');
 list.onclick=e=>{const i=e.target.closest('.item');if(!i)return;toggleLock(i.dataset.code);};
 const search=document.getElementById('search');
 search.oninput=()=>{const q=search.value.toLowerCase();for(const i of list.children){i.style.display=i.textContent.toLowerCase().includes(q)?'':'none';}};
}
</script>
</body>
</html>
